<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>润藏命理 - 专业命理分析服务</title>
    <style>
        :root {
            --primary-color: #6a1b9a;
            --secondary-color: #9c27b0;
            --accent-color: #e1bee7;
            --text-color: #333;
            --light-bg: #f5f5f5;
            --white: #ffffff;
            --error-color: #f44336;
            --success-color: #4caf50;
            --shadow: 0 5px 15px rgba(0,0,0,0.05);
            --transition: all 0.3s ease;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background-color: var(--light-bg);
            color: var(--text-color);
            line-height: 1.6;
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        section {
            padding: 80px 0;
        }
        
        h1, h2, h3, h4 {
            color: var(--primary-color);
            margin-bottom: 20px;
        }
        
        p {
            margin-bottom: 15px;
        }
        
        .btn {
            display: inline-block;
            padding: 12px 30px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: var(--transition);
            text-decoration: none;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .btn:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        
        /* 导航栏样式 */
        header {
            background-color: var(--white);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
        }
        
        .logo {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .nav-links {
            display: flex;
            list-style: none;
        }
        
        .nav-links li {
            margin-left: 30px;
        }
        
        .nav-links a {
            text-decoration: none;
            color: var(--text-color);
            font-weight: 500;
            transition: var(--transition);
        }
        
        .nav-links a:hover {
            color: var(--primary-color);
        }
        
        /* 英雄区域 */
        .hero {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            text-align: center;
            padding: 120px 0;
            position: relative;
            overflow: hidden;
        }
        
        .hero::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="none"><path d="M0,0 L100,0 L100,100 Z" fill="rgba(255,255,255,0.1)"/></svg>');
            background-size: cover;
        }
        
        .hero-content {
            position: relative;
            z-index: 1;
        }
        
        .hero h1 {
            font-size: 3.5rem;
            margin-bottom: 20px;
            color: white;
            text-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .hero p {
            font-size: 1.3rem;
            max-width: 700px;
            margin: 0 auto 30px;
            opacity: 0.9;
        }
        
        /* 服务卡片样式 */
        .services {
            background-color: var(--white);
        }
        
        .section-title {
            text-align: center;
            margin-bottom: 60px;
        }
        
        .section-title h2 {
            position: relative;
            display: inline-block;
            padding-bottom: 15px;
        }
        
        .section-title h2::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 3px;
            background-color: var(--primary-color);
        }
        
        .services-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 30px;
        }
        
        .service-card {
            background-color: var(--white);
            border-radius: 8px;
            box-shadow: var(--shadow);
            padding: 30px;
            text-align: center;
            transition: var(--transition);
            border-top: 4px solid var(--primary-color);
        }
        
        .service-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.1);
        }
        
        .service-card h3 {
            margin-bottom: 15px;
            color: var(--primary-color);
        }
        
        .price {
            font-size: 2rem;
            color: var(--secondary-color);
            font-weight: bold;
            margin: 15px 0;
        }
        
        .service-features {
            list-style: none;
            text-align: left;
            margin: 20px 0;
        }
        
        .service-features li {
            margin-bottom: 10px;
            padding-left: 20px;
            position: relative;
        }
        
        .service-features li::before {
            content: "✓";
            position: absolute;
            left: 0;
            color: var(--secondary-color);
            font-weight: bold;
        }
        
        /* 表单样式 */
        .form-container {
            background-color: var(--white);
            border-radius: 8px;
            box-shadow: var(--shadow);
            padding: 40px;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .required::after {
            content: " *";
            color: var(--error-color);
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            transition: var(--transition);
        }
        
        input:focus, select:focus, textarea:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 2px rgba(106, 27, 154, 0.2);
        }
        
        .error {
            color: var(--error-color);
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }
        
        .form-row {
            display: flex;
            gap: 20px;
        }
        
        .form-row .form-group {
            flex: 1;
        }
        
        .payment-options {
            display: flex;
            gap: 20px;
            margin-top: 30px;
        }
        
        .payment-option {
            flex: 1;
            text-align: center;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .payment-option.active {
            border-color: var(--primary-color);
            background-color: rgba(106, 27, 154, 0.05);
        }
        
        .payment-icon {
            font-size: 2rem;
            margin-bottom: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 60px;
        }
        
        .payment-icon img {
            max-width: 100%;
            max-height: 40px;
        }
        
        /* 支付弹窗样式 */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        
        .modal-content {
            background-color: var(--white);
            margin: 5% auto;
            padding: 30px;
            border-radius: 8px;
            box-shadow: var(--shadow);
            width: 90%;
            max-width: 500px;
            position: relative;
        }
        
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            line-height: 1;
        }
        
        .close:hover {
            color: var(--text-color);
        }
        
        .qr-codes {
            display: flex;
            justify-content: center;
            margin: 20px 0;
        }
        
        .qr-code {
            text-align: center;
        }
        
        .qr-code img {
            width: 260px;
            height: 260px;
            border: 1px solid #ddd;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        
        /* 加载动画 */
        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }
        
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top: 4px solid var(--primary-color);
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* 分析过程样式 */
        .analysis-process {
            display: none;
            text-align: center;
            padding: 40px;
            background-color: var(--white);
            border-radius: 8px;
            box-shadow: var(--shadow);
            max-width: 800px;
            margin: 0 auto;
        }
        
        .analysis-steps {
            text-align: left;
            margin: 30px 0;
        }
        
        .analysis-step {
            margin-bottom: 20px;
            padding: 15px;
            border-left: 4px solid var(--primary-color);
            background-color: rgba(106, 27, 154, 0.05);
            border-radius: 0 4px 4px 0;
        }
        
        .analysis-step.completed {
            border-left-color: var(--success-color);
        }
        
        .analysis-step.active {
            border-left-color: var(--secondary-color);
            background-color: rgba(156, 39, 176, 0.1);
        }
        
        .step-icon {
            display: inline-block;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background-color: #ddd;
            color: white;
            text-align: center;
            line-height: 24px;
            margin-right: 10px;
        }
        
        .analysis-step.completed .step-icon {
            background-color: var(--success-color);
        }
        
        .analysis-step.active .step-icon {
            background-color: var(--secondary-color);
        }
        
        /* 分析结果样式 */
        .analysis-result {
            display: none;
            text-align: left;
            margin-top: 30px;
            padding: 30px;
            background-color: rgba(225, 190, 231, 0.1);
            border-radius: 8px;
            border: 1px solid var(--accent-color);
            white-space: pre-wrap;
            font-size: 16px;
            line-height: 1.8;
            max-height: 600px;
            overflow-y: auto;
        }
        
        .result-actions {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            justify-content: center;
        }
        
        .word-count {
            text-align: center;
            margin-top: 15px;
            color: #666;
            font-size: 14px;
        }
        
        /* 成功消息 */
        .success-message {
            display: none;
            text-align: center;
            padding: 40px;
            background-color: var(--white);
            border-radius: 8px;
            box-shadow: var(--shadow);
            max-width: 800px;
            margin: 0 auto;
        }
        
        .success-icon {
            font-size: 4rem;
            color: var(--success-color);
            margin-bottom: 20px;
        }
        
        /* 页脚样式 */
        footer {
            background-color: #2c2c2c;
            color: white;
            padding: 60px 0 20px;
        }
        
        .footer-content {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            margin-bottom: 40px;
        }
        
        .footer-column {
            flex: 1;
            min-width: 250px;
            margin-bottom: 30px;
        }
        
        .footer-column h3 {
            color: white;
            margin-bottom: 20px;
        }
        
        .footer-links {
            list-style: none;
        }
        
        .footer-links li {
            margin-bottom: 10px;
        }
        
        .footer-links a {
            color: #ddd;
            text-decoration: none;
            transition: var(--transition);
        }
        
        .footer-links a:hover {
            color: var(--accent-color);
        }
        
        .copyright {
            text-align: center;
            padding-top: 20px;
            border-top: 1px solid #444;
        }
        
        /* 收款码样式优化 */
        .payment-status {
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid var(--primary-color);
        }

        .payment-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }

        .order-info {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .order-info p {
            margin-bottom: 8px;
        }
        
        /* 响应式设计 */
        @media (max-width: 768px) {
            .navbar {
                flex-direction: column;
            }
            
            .nav-links {
                margin-top: 20px;
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .nav-links li {
                margin: 0 10px 10px;
            }
            
            .hero h1 {
                font-size: 2.2rem;
            }
            
            .hero p {
                font-size: 1.1rem;
            }
            
            .form-row {
                flex-direction: column;
                gap: 0;
            }
            
            .payment-options {
                flex-direction: column;
            }
            
            section {
                padding: 60px 0;
            }
            
            .qr-codes {
                flex-direction: column;
                gap: 20px;
            }
            
            .modal-content {
                width: 95%;
                margin: 10% auto;
                padding: 20px;
            }
            
            .result-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- 导航栏 -->
    <header>
        <div class="container">
            <nav class="navbar">
                <div class="logo">润藏命理</div>
                <ul class="nav-links">
                    <li><a href="#home">首页</a></li>
                    <li><a href="#services">服务项目</a></li>
                    <li><a href="#contact">联系我们</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- 首页内容 -->
    <section id="home" class="hero">
        <div class="container">
            <div class="hero-content">
                <h1>探索命运奥秘，洞悉人生轨迹</h1>
                <p>专业命理师团队，结合传统智慧与现代算法，为您揭示人生密码，提供精准运势指导</p>
                <a href="#services" class="btn">立即测算</a>
            </div>
        </div>
    </section>

    <!-- 服务项目 -->
    <section id="services" class="services">
        <div class="container">
            <div class="section-title">
                <h2>专业命理服务</h2>
                <p>选择适合您的咨询服务，开启命运探索之旅</p>
            </div>
            <div class="services-grid">
                <!-- 测试验证服务 -->
                <div class="service-card">
                    <h3>测试验证服务</h3>
                    <div class="price">¥19.9</div>
                    <ul class="service-features">
                        <li>深入分析八字原局喜忌</li>
                        <li>解读性格特点</li>
                        <li>测算之前每步大运吉凶</li>
                        <li>过往关键流年吉凶验证</li>
                    </ul>
                    <a href="javascript:void(0)" class="btn" onclick="selectService('测试验证服务', 19.9)">立即购买</a>
                </div>
                
                <!-- 流年运势分析 -->
                <div class="service-card">
                    <h3>流年运势分析</h3>
                    <div class="price">¥38</div>
                    <ul class="service-features">
                        <li>深入分析八字原局喜忌</li>
                        <li>解读性格特点</li>
                        <li>测算当年及往后5年运势</li>
                        <li>事业财运、婚姻感情等人生大事分析</li>
                    </ul>
                    <a href="javascript:void(0)" class="btn" onclick="selectService('流年运势分析', 38)">立即购买</a>
                </div>
                
                <!-- 人生详批服务 -->
                <div class="service-card">
                    <h3>人生详批服务</h3>
                    <div class="price">¥138</div>
                    <ul class="service-features">
                        <li>深入分析八字原局喜忌</li>
                        <li>解读性格特点</li>
                        <li>人生每步大运吉凶分析</li>
                        <li>人生高低点分析</li>
                        <li>往后关键流年分析</li>
                        <li>重要人生事项提醒</li>
                        <li>风水建议</li>
                    </ul>
                    <a href="javascript:void(0)" class="btn" onclick="selectService('人生详批服务', 138)">立即购买</a>
                </div>
                
                <!-- 婚缘配对分析 -->
                <div class="service-card">
                    <h3>婚缘配对分析</h3>
                    <div class="price">¥52</div>
                    <ul class="service-features">
                        <li>分析与伴侣的八字契合度</li>
                        <li>解读感情发展趋势</li>
                        <li>提供婚姻建议</li>
                    </ul>
                    <a href="javascript:void(0)" class="btn" onclick="selectService('婚缘配对分析', 52)">立即购买</a>
                </div>
            </div>
        </div>
    </section>

    <!-- 信息收集表单 -->
    <section id="info-form" class="info-form" style="display: none;">
        <div class="container">
            <div class="section-title">
                <h2>填写个人信息</h2>
                <p>请提供准确的出生信息，以确保分析结果的准确性</p>
            </div>
            <div class="form-container">
                <form id="user-info-form">
                    <div class="form-group">
                        <label for="service-type" class="required">服务类型</label>
                        <input type="text" id="service-type" readonly>
                    </div>
                    
                    <div class="form-group">
                        <label for="name" class="required">姓名</label>
                        <input type="text" id="name" required>
                        <div class="error" id="name-error">请输入姓名</div>
                    </div>
                    
                    <div id="single-person-info">
                        <h3>个人出生信息</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="birth-year" class="required">出生年份</label>
                                <input type="number" id="birth-year" min="1900" max="2023" required>
                                <div class="error" id="birth-year-error">请输入有效的出生年份</div>
                            </div>
                            <div class="form-group">
                                <label for="birth-month" class="required">出生月份</label>
                                <select id="birth-month" required>
                                    <option value="">请选择</option>
                                    <option value="1">1月</option>
                                    <option value="2">2月</option>
                                    <option value="3">3月</option>
                                    <option value="4">4月</option>
                                    <option value="5">5月</option>
                                    <option value="6">6月</option>
                                    <option value="7">7月</option>
                                    <option value="8">8月</option>
                                    <option value="9">9月</option>
                                    <option value="10">10月</option>
                                    <option value="11">11月</option>
                                    <option value="12">12月</option>
                                </select>
                                <div class="error" id="birth-month-error">请选择出生月份</div>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="birth-day" class="required">出生日期</label>
                                <input type="number" id="birth-day" min="1" max="31" required>
                                <div class="error" id="birth-day-error">请输入有效的出生日期</div>
                            </div>
                            <div class="form-group">
                                <label for="birth-hour" class="required">出生时辰</label>
                                <select id="birth-hour" required>
                                    <option value="">请选择</option>
                                    <!-- 生成0-23时的选项 -->
                                </select>
                                <div class="error" id="birth-hour-error">请选择出生时辰</div>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="birth-minute" class="required">出生分钟</label>
                                <select id="birth-minute" required>
                                    <option value="">请选择</option>
                                    <!-- 生成0-59分的选项 -->
                                </select>
                                <div class="error" id="birth-minute-error">请选择出生分钟</div>
                            </div>
                            <div class="form-group">
                                <label for="gender" class="required">性别</label>
                                <select id="gender" required>
                                    <option value="">请选择</option>
                                    <option value="male">男</option>
                                    <option value="female">女</option>
                                </select>
                                <div class="error" id="gender-error">请选择性别</div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="partner-info" style="display: none;">
                        <h3>伴侣出生信息</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="partner-name">伴侣姓名</label>
                                <input type="text" id="partner-name">
                            </div>
                            <div class="form-group">
                                <label for="partner-gender">伴侣性别</label>
                                <select id="partner-gender">
                                    <option value="">请选择</option>
                                    <option value="male">男</option>
                                    <option value="female">女</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="partner-birth-year">伴侣出生年份</label>
                                <input type="number" id="partner-birth-year" min="1900" max="2023">
                                <div class="error" id="partner-birth-year-error">请输入有效的伴侣出生年份</div>
                            </div>
                            <div class="form-group">
                                <label for="partner-birth-month">伴侣出生月份</label>
                                <select id="partner-birth-month">
                                    <option value="">请选择</option>
                                    <option value="1">1月</option>
                                    <option value="2">2月</option>
                                    <option value="3">3月</option>
                                    <option value="4">4月</option>
                                    <option value="5">5月</option>
                                    <option value="6">6月</option>
                                    <option value="7">7月</option>
                                    <option value="8">8月</option>
                                    <option value="9">9月</option>
                                    <option value="10">10月</option>
                                    <option value="11">11月</option>
                                    <option value="12">12月</option>
                                </select>
                                <div class="error" id="partner-birth-month-error">请选择伴侣出生月份</div>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="partner-birth-day">伴侣出生日期</label>
                                <input type="number" id="partner-birth-day" min="1" max="31">
                                <div class="error" id="partner-birth-day-error">请输入有效的伴侣出生日期</div>
                            </div>
                            <div class="form-group">
                                <label for="partner-birth-hour">伴侣出生时辰</label>
                                <select id="partner-birth-hour">
                                    <option value="">请选择</option>
                                    <!-- 生成0-23时的选项 -->
                                </select>
                                <div class="error" id="partner-birth-hour-error">请选择伴侣出生时辰</div>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="partner-birth-minute">伴侣出生分钟</label>
                                <select id="partner-birth-minute">
                                    <option value="">请选择</option>
                                    <!-- 生成0-59分的选项 -->
                                </select>
                                <div class="error" id="partner-birth-minute-error">请选择伴侣出生分钟</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="specific-request">具体求测事项（可选）</label>
                        <textarea id="specific-request" rows="4"></textarea>
                    </div>
                    
                    <h3>选择支付方式</h3>
                    <div class="payment-options">
                        <div class="payment-option" id="wechat-pay" onclick="selectPayment('wechat')">
                            <div class="payment-icon">
                                <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDI0IDEwMjQiIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCI+PHBhdGggZmlsbD0iIzA3QzE2MCIgZD0iTTUxMiA2NEMyNjQuNiA2NCA2NCAyNjQuNiA2NCA1MTJzMjAwLjYgNDQ4IDQ0OCA0NDggNDQ4LTIwMC42IDQ0OC00NDhTNzU5LjQgNjQgNTEyIDY0em0yNzQuNiA0MTUuNGMtMTUuOS0yNi4yLTM3LjEtNDYuOC02MS45LTYwLjQtMjcuNi0xNS4yLTU5LjgtMjMuMy05My4zLTIzLjMtMzMuNSAwLTY1LjcgOC4xLTkzLjMgMjMuMy0yNC44IDEzLjYtNDYgMzQuMi02MS45IDYwLjQtMTUuOSAyNi4yLTI0LjMgNTYuMi0yNC4zIDg2LjcgMCAzMC41IDguNCA2MC41IDI0LjMgODYuNyAxNS45IDI2LjIgMzcuMSA0Ni44IDYxLjkgNjAuNCAyNy42IDE1LjIgNTkuOCAyMy4zIDkzLjMgMjMuMyAzMy41IDAgNjUuNy04LjEgOTMuMy0yMy4zIDI0LjgtMTMuNiA0Ni0zNC4yIDYxLjktNjAuNCAxNS45LTI2LjIgMjQuMy01Ni4yIDI0LjMtODYuNyAwLTMwLjUtOC40LTYwLjUtMjQuMy04Ni43eiIvPjxwYXRoIGZpbGw9IiNGRkYiIGQ9Ik0zOTUuOCA1MjcuMmMtMzAuOSAwLTU2LTI1LjEtNTYtNTZzMjUuMS01NiA1Ni01NiA1NiAyNS4xIDU2IDU2LTI1LjEgNTYtNTYgNTZ6bTIzMi40IDBjLTMwLjkgMC01Ni0yNS4xLTU2LTU2czI1LjEtNTYgNTYtNTYgNTYgMjUuMSA1NiA1Ni0yNS4xIDU2LTU2IDU2eiIvPjwvc3ZnPg==" alt="微信支付">
                            </div>
                            <div>微信支付</div>
                        </div>
                        <div class="payment-option" id="alipay" onclick="selectPayment('alipay')">
                            <div class="payment-icon">
                                <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDI0IDEwMjQiIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCI+PHBhdGggZmlsbD0iIzAwOTZFQyIgZD0iTTUxMiA2NEMyNjQuNiA2NCA2NCAyNjQuNiA2NCA1MTJzMjAwLjYgNDQ4IDQ0OCA0NDggNDQ4LTIwMC42IDQ0OC00NDhTNzU5LjQgNjQgNTEyIDY0em0yNzQuNiA0MTUuNGMtMTUuOS0yNi4yLTM3LjEtNDYuOC02MS45LTYwLjQtMjcuNi0xNS4yLTU5LjgtMjMuMy05My4zLTIzLjMtMzMuNSAwLTY1LjcgOC4xLTkzLjMgMjMuMy0yNC44IDEzLjYtNDYgMzMuMi02MS45IDYwLjQtMTUuOSAyNi4yLTI0LjMgNTYuMi0yNC4zIDg2LjcgMCAzMC41IDguNCA2MC41IDI0LjMgODYuNyAxNS45IDI2LjIgMzcuMSA0Ni44IDYxLjkgNjAuNCAyNy42IDE1LjIgNTkuOCAyMy4zIDkzLjMgMjMuMyAzMy41IDAgNjUuNy04LjEgOTMuMy0yMy4zIDI0LjgtMTMuNiA0Ni0zNC4yIDYxLjktNjAuNCAxNS45LTI2LjIgMjQuMy01Ni4yIDI0LjMtODYuNyAwLTMwLjUtOC40LTYwLjUtMjQuMy04Ni43eiIvPjxwYXRoIGZpbGw9IiNGRkYiIGQ9Ik00MjAuOSA0MTUuNGMtMzAuOSAwLTU2LTI1LjEtNTYtNTZzMjUuMS01NiA1Ni01NiA1NiAyNS4xIDU2IDU2LTI1LjEgNTYtNTYgNTZ6bTE4Mi4yIDBjLTMwLjkgMC01Ni0yNS4xLTU2LTU2czI1LjEtNTYgNTYtNTYgNTYgMjUuMSA1NiA1Ni0yNS4xIDU2LTU2IDU2eiIvPjwvc3ZnPg==" alt="支付宝">
                            </div>
                            <div>支付宝</div>
                        </div>
                    </div>
                    <div class="error" id="payment-error" style="margin-top: 10px;">请选择支付方式</div>
                    
                    <div class="form-group" style="margin-top: 30px; display: flex; gap: 10px;">
                        <button type="button" class="btn" id="submit-btn" onclick="submitForm()">立即支付</button>
                        <button type="button" class="btn" style="background-color: #6c757d;" onclick="resetForm()">重新选择服务</button>
                    </div>
                </form>
            </div>
        </div>
    </section>

    <!-- 支付弹窗 -->
    <div id="payment-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>支付订单</h3>
                <span class="close" onclick="closePaymentModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="order-info">
                    <p><strong>服务类型:</strong> <span id="payment-service-type"></span></p>
                    <p><strong>订单金额:</strong> <span id="payment-amount"></span></p>
                    <p><strong>订单号:</strong> <span id="payment-order-id"></span></p>
                </div>
                
                <div class="qr-codes">
                    <div class="qr-code" id="wechat-qr-container">
                        <img id="wechat-qr" src="https://via.placeholder.com/260x260?text=微信收款码" alt="微信个人收款码">
                        <p>微信支付</p>
                    </div>
                    <div class="qr-code" id="alipay-qr-container">
                        <img id="alipay-qr" src="https://via.placeholder.com/260x260?text=支付宝收款码" alt="支付宝个人收款码">
                        <p>支付宝</p>
                    </div>
                </div>
                
                <div class="payment-status">
                    <p id="payment-status-text">请使用微信/支付宝扫描上方二维码完成支付</p>
                </div>
                
                <div class="payment-actions">
                    <button class="btn" onclick="confirmPayment()">我已支付</button>
                    <button class="btn" style="background-color: #6c757d;" onclick="closePaymentModal()">取消支付</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 分析过程 -->
    <section id="analysis-process-section" class="analysis-process" style="display: none;">
        <div class="container">
            <div class="spinner"></div>
            <h3>润藏命理团队正在为您分析</h3>
            <p>基于您的出生信息和求测事项，我们的专业命理师团队正在深入分析...</p>
            
            <div class="analysis-steps">
                <div class="analysis-step" id="step1">
                    <span class="step-icon">1</span>
                    <strong>八字排盘</strong> - 正在计算您的八字命盘...
                </div>
                <div class="analysis-step" id="step2">
                    <span class="step-icon">2</span>
                    <strong>大运分析</strong> - 正在分析您的人生大运走势...
                </div>
                <div class="analysis-step" id="step3">
                    <span class="step-icon">3</span>
                    <strong>流年运势</strong> - 正在计算您的流年吉凶...
                </div>
                <div class="analysis-step" id="step4">
                    <span class="step-icon">4</span>
                    <strong>综合分析</strong> - 正在生成完整的命理报告...
                </div>
            </div>
            
            <div class="analysis-result" id="analysis-result">
                <div id="result-content" style="margin-bottom: 20px;"></div>
                <div class="word-count">报告字数: <span id="word-count">0</span> 字</div>
                <div class="result-actions">
                    <button class="btn" onclick="copyResult()">复制结果</button>
                    <button class="btn" onclick="downloadResult()">下载报告</button>
                    <button class="btn" style="background-color: #6c757d;" onclick="goToHome()">返回首页</button>
                </div>
            </div>
        </div>
    </section>

    <!-- 成功消息 -->
    <section id="success-section" class="success-message" style="display: none;">
        <div class="success-icon">✓</div>
        <h2>支付成功！</h2>
        <p>您的订单已提交成功，润藏命理团队正在为您分析</p>
        <p>分析结果将在下方展示</p>
        <p>订单号: <span id="order-id"></span></p>
        <div style="margin-top: 30px;">
            <button class="btn" onclick="goToHome()">返回首页</button>
        </div>
    </section>

    <!-- 页脚 -->
    <footer id="contact">
        <div class="container">
            <div class="footer-content">
                <div class="footer-column">
                    <h3>润藏命理</h3>
                    <p>专业命理师团队分析平台，结合传统智慧与现代技术，为您提供精准的命运解读和人生指导。</p>
                </div>
                <div class="footer-column">
                    <h3>服务项目</h3>
                    <ul class="footer-links">
                        <li><a href="#services">测试验证服务</a></li>
                        <li><a href="#services">流年运势分析</a></li>
                        <li><a href="#services">人生详批服务</a></li>
                        <li><a href="#services">婚缘配对分析</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>联系我们</h3>
                    <ul class="footer-links">
                        <li>客服微信: runzang888</li>
                        <li>客服电话: 400-000-1388</li>
                        <li>服务时间: 9:00-17:00</li>
                    </ul>
                </div>
            </div>
            <div class="copyright">
                <p>&copy; 2023 润藏命理咨询平台 版权所有</p>
            </div>
        </div>
    </footer>

    <script>
        // DeepSeek API密钥
        const DEEPSEEK_API_KEY = 'sk-0c763bf4e169413dbd57a45e8ca73a6a';
        const DEEPSEEK_API_URL = 'https://api.deepseek.com/v1/chat/completions';
        
        // 当前选择的支付信息
        let currentPaymentInfo = null;
        let currentUserData = null;
        let currentPaymentMethod = null;
        
        // 命理分析提示词模板
        const PROMPT_TEMPLATES = {
            '测试验证服务': `你是一位职业的命理大师，请根据以下信息进行八字分析：

用户信息：
姓名：{name}
性别：{gender}
出生时间：{birthYear}年{birthMonth}月{birthDay}日{birthHour}时{birthMinute}分

请进行以下分析：
1. 分析八字原局喜忌
2. 解读性格特点
3. 测算之前每步大运吉凶
4. 过往关键流年吉凶验证
5. 提供专业建议

请用专业、详细但易懂的语言回复，字数在2000-3000字左右。`,

            '流年运势分析': `你是一位职业的命理大师，请根据以下信息进行八字分析：

用户信息：
姓名：{name}
性别：{gender}
出生时间：{birthYear}年{birthMonth}月{birthDay}日{birthHour}时{birthMinute}分
具体求测事项：{specificRequest}

请进行以下分析：
1. 分析八字原局喜忌
2. 解读性格特点
3. 测算当年及往后5年运势
4. 事业财运、婚姻感情等人生大事分析
5. 提供年度建议和注意事项

请用专业、详细但易懂的语言回复，字数在2000-3000字左右。`,

            '人生详批服务': `你是一位职业的命理大师，请根据以下信息进行八字分析：

用户信息：
姓名：{name}
性别：{gender}
出生时间：{birthYear}年{birthMonth}月{birthDay}日{birthHour}时{birthMinute}分
具体求测事项：{specificRequest}

请进行以下全面分析：
1. 深入分析八字原局喜忌
2. 详细解读性格特点
3. 人生每步大运吉凶分析
4. 人生高低点分析
5. 往后关键流年分析
6. 重要人生事项提醒
7. 风水建议和个人发展建议

请用专业、详尽但易懂的语言回复，字数在2500-3500字左右。`,

            '婚缘配对分析': `你是一位职业的命理大师，请根据以下信息进行八字分析：

用户信息：
姓名：{name}
性别：{gender}
出生时间：{birthYear}年{birthMonth}月{birthDay}日{birthHour}时{birthMinute}分

伴侣信息：
姓名：{partnerName}
性别：{partnerGender}
出生时间：{partnerBirthYear}年{partnerBirthMonth}月{partnerBirthDay}日{partnerBirthHour}时{partnerBirthMinute}分

具体求测事项：{specificRequest}

请进行以下分析：
1. 分析双方的八字契合度
2. 解读感情发展趋势
3. 婚姻稳定性分析
4. 双方性格匹配度
5. 提供婚姻建议和注意事项

请用专业、详细但易懂的语言回复，字数在2000-3000字左右。`
        };
        
        // 生成小时和分钟选项
        function generateTimeOptions() {
            const hourSelect = document.getElementById('birth-hour');
            const minuteSelect = document.getElementById('birth-minute');
            const partnerHourSelect = document.getElementById('partner-birth-hour');
            const partnerMinuteSelect = document.getElementById('partner-birth-minute');
            
            // 生成小时选项 (0-23)
            for (let i = 0; i < 24; i++) {
                const hour = i < 10 ? '0' + i : i;
                const option = document.createElement('option');
                option.value = i;
                option.textContent = hour + '时';
                hourSelect.appendChild(option);
                
                const partnerOption = option.cloneNode(true);
                partnerHourSelect.appendChild(partnerOption);
            }
            
            // 生成分钟选项 (0-59)
            for (let i = 0; i < 60; i++) {
                const minute = i < 10 ? '0' + i : i;
                const option = document.createElement('option');
                option.value = i;
                option.textContent = minute + '分';
                minuteSelect.appendChild(option);
                
                const partnerOption = option.cloneNode(true);
                partnerMinuteSelect.appendChild(partnerOption);
            }
        }
        
        // 选择服务
        function selectService(serviceName, price) {
            document.getElementById('service-type').value = serviceName + ' - ¥' + price;
            
            // 显示/隐藏伴侣信息区域
            if (serviceName === '婚缘配对分析') {
                document.getElementById('partner-info').style.display = 'block';
            } else {
                document.getElementById('partner-info').style.display = 'none';
            }
            
            // 滚动到表单区域
            document.getElementById('info-form').style.display = 'block';
            document.getElementById('info-form').scrollIntoView({ behavior: 'smooth' });
            
            // 重置表单错误状态
            resetErrors();
        }
        
        // 选择支付方式
        function selectPayment(type) {
            document.querySelectorAll('.payment-option').forEach(option => {
                option.classList.remove('active');
            });
            
            if (type === 'wechat') {
                document.getElementById('wechat-pay').classList.add('active');
            } else if (type === 'alipay') {
                document.getElementById('alipay').classList.add('active');
            }
            
            currentPaymentMethod = type;
            
            // 隐藏支付错误
            document.getElementById('payment-error').style.display = 'none';
        }
        
        // 重置表单
        function resetForm() {
            document.getElementById('info-form').style.display = 'none';
            document.getElementById('user-info-form').reset();
            resetErrors();
            document.querySelectorAll('.payment-option').forEach(option => {
                option.classList.remove('active');
            });
            
            currentPaymentMethod = null;
            
            // 滚动到服务区域
            document.getElementById('services').scrollIntoView({ behavior: 'smooth' });
        }
        
        // 重置错误状态
        function resetErrors() {
            document.querySelectorAll('.error').forEach(error => {
                error.style.display = 'none';
            });
        }
        
        // 验证表单
        function validateForm() {
            let isValid = true;
            resetErrors();
            
            // 验证姓名
            const name = document.getElementById('name').value;
            if (!name.trim()) {
                document.getElementById('name-error').style.display = 'block';
                isValid = false;
            }
            
            // 验证出生年份
            const birthYear = document.getElementById('birth-year').value;
            if (!birthYear || birthYear < 1900 || birthYear > 2023) {
                document.getElementById('birth-year-error').style.display = 'block';
                isValid = false;
            }
            
            // 验证出生月份
            const birthMonth = document.getElementById('birth-month').value;
            if (!birthMonth) {
                document.getElementById('birth-month-error').style.display = 'block';
                isValid = false;
            }
            
            // 验证出生日期
            const birthDay = document.getElementById('birth-day').value;
            if (!birthDay || birthDay < 1 || birthDay > 31) {
                document.getElementById('birth-day-error').style.display = 'block';
                isValid = false;
            } else {
                // 验证日期有效性（简单版本）
                const year = parseInt(birthYear);
                const month = parseInt(birthMonth);
                const day = parseInt(birthDay);
                
                if (month === 2 && day > 29) {
                    document.getElementById('birth-day-error').textContent = '2月最多29天';
                    document.getElementById('birth-day-error').style.display = 'block';
                    isValid = false;
                } else if ([4, 6, 9, 11].includes(month) && day > 30) {
                    document.getElementById('birth-day-error').textContent = '该月份最多30天';
                    document.getElementById('birth-day-error').style.display = 'block';
                    isValid = false;
                }
            }
            
            // 验证出生时辰
            const birthHour = document.getElementById('birth-hour').value;
            if (!birthHour) {
                document.getElementById('birth-hour-error').style.display = 'block';
                isValid = false;
            }
            
            // 验证出生分钟
            const birthMinute = document.getElementById('birth-minute').value;
            if (!birthMinute) {
                document.getElementById('birth-minute-error').style.display = 'block';
                isValid = false;
            }
            
            // 验证性别
            const gender = document.getElementById('gender').value;
            if (!gender) {
                document.getElementById('gender-error').style.display = 'block';
                isValid = false;
            }
            
            // 如果是婚缘配对分析，验证伴侣信息
            const serviceType = document.getElementById('service-type').value;
            if (serviceType.includes('婚缘配对分析')) {
                const partnerBirthYear = document.getElementById('partner-birth-year').value;
                if (!partnerBirthYear || partnerBirthYear < 1900 || partnerBirthYear > 2023) {
                    document.getElementById('partner-birth-year-error').style.display = 'block';
                    isValid = false;
                }
                
                const partnerBirthMonth = document.getElementById('partner-birth-month').value;
                if (!partnerBirthMonth) {
                    document.getElementById('partner-birth-month-error').style.display = 'block';
                    isValid = false;
                }
                
                const partnerBirthDay = document.getElementById('partner-birth-day').value;
                if (!partnerBirthDay || partnerBirthDay < 1 || partnerBirthDay > 31) {
                    document.getElementById('partner-birth-day-error').style.display = 'block';
                    isValid = false;
                }
                
                const partnerBirthHour = document.getElementById('partner-birth-hour').value;
                if (!partnerBirthHour) {
                    document.getElementById('partner-birth-hour-error').style.display = 'block';
                    isValid = false;
                }
                
                const partnerBirthMinute = document.getElementById('partner-birth-minute').value;
                if (!partnerBirthMinute) {
                    document.getElementById('partner-birth-minute-error').style.display = 'block';
                    isValid = false;
                }
            }
            
            // 验证支付方式
            if (!currentPaymentMethod) {
                document.getElementById('payment-error').style.display = 'block';
                isValid = false;
            }
            
            return isValid;
        }
        
        // 提交表单
        function submitForm() {
            if (!validateForm()) {
                return;
            }
            
            // 获取服务信息
            const serviceType = document.getElementById('service-type').value;
            const serviceName = serviceType.split(' - ')[0];
            const price = parseFloat(serviceType.split('¥')[1]);
            
            // 生成订单ID
            const orderId = 'RZ' + Date.now();
            
            // 保存当前支付信息
            currentPaymentInfo = {
                serviceName: serviceName,
                price: price,
                orderId: orderId
            };
            
            // 收集用户数据
            currentUserData = collectUserData();
            
            // 显示支付弹窗
            document.getElementById('payment-service-type').textContent = serviceName;
            document.getElementById('payment-amount').textContent = '¥' + price;
            document.getElementById('payment-order-id').textContent = orderId;
            
            // 根据支付方式更新支付弹窗内容
            updatePaymentModalContent();
            
            document.getElementById('payment-modal').style.display = 'block';
        }
        
        // 更新支付弹窗内容
        function updatePaymentModalContent() {
            const wechatQRContainer = document.getElementById('wechat-qr-container');
            const alipayQRContainer = document.getElementById('alipay-qr-container');
            const statusText = document.getElementById('payment-status-text');
            const orderId = document.getElementById('payment-order-id').textContent;
            
            // 根据支付方式显示对应的二维码
            if (currentPaymentMethod === 'wechat') {
                wechatQRContainer.style.display = 'block';
                alipayQRContainer.style.display = 'none';
                statusText.innerHTML = `请使用微信扫描上方二维码完成支付<br>
                                        <strong>支付时请务必备注订单号: ${orderId}</strong><br>
                                        支付完成后请点击"我已支付"按钮`;
            } else if (currentPaymentMethod === 'alipay') {
                wechatQRContainer.style.display = 'none';
                alipayQRContainer.style.display = 'block';
                statusText.innerHTML = `请使用支付宝扫描上方二维码完成支付<br>
                                        <strong>支付时请务必备注订单号: ${orderId}</strong><br>
                                        支付完成后请点击"我已支付"按钮`;
            }
        }
        
        // 关闭支付弹窗
        function closePaymentModal() {
            document.getElementById('payment-modal').style.display = 'none';
        }
        
        // 确认支付
        function confirmPayment() {
            const orderId = document.getElementById('payment-order-id').textContent;
            const confirmed = confirm(`请确认您已完成支付并备注了订单号: ${orderId}\n\n如果未备注订单号，我们将无法为您提供服务。\n\n确认已支付?`);
            
            if (confirmed) {
                // 关闭支付弹窗
                closePaymentModal();
                
                // 显示成功消息
                document.getElementById('success-section').style.display = 'block';
                document.getElementById('order-id').textContent = currentPaymentInfo.orderId;
                document.getElementById('success-section').scrollIntoView({ behavior: 'smooth' });
                
                // 隐藏表单
                document.getElementById('info-form').style.display = 'none';
                
                // 开始分析
                setTimeout(() => {
                    startAnalysis();
                }, 2000);
            }
        }
        
        // 开始分析
        async function startAnalysis() {
            // 隐藏成功消息，显示分析过程
            document.getElementById('success-section').style.display = 'none';
            document.getElementById('analysis-process-section').style.display = 'block';
            document.getElementById('analysis-process-section').scrollIntoView({ behavior: 'smooth' });
            
            // 更新分析步骤
            updateAnalysisStep(1);
            
            try {
                // 调用DeepSeek API进行命理分析
                const analysisResult = await callDeepSeekAPI(currentUserData);
                
                // 显示分析结果
                displayAnalysisResult(analysisResult);
                
            } catch (error) {
                console.error('分析失败:', error);
                document.getElementById('result-content').textContent = '分析失败，请稍后重试或联系客服。错误信息: ' + error.message;
                document.getElementById('analysis-result').style.display = 'block';
            }
        }
        
        // 收集用户数据
        function collectUserData() {
            const serviceType = document.getElementById('service-type').value;
            const name = document.getElementById('name').value;
            const birthYear = document.getElementById('birth-year').value;
            const birthMonth = document.getElementById('birth-month').value;
            const birthDay = document.getElementById('birth-day').value;
            const birthHour = document.getElementById('birth-hour').value;
            const birthMinute = document.getElementById('birth-minute').value;
            const gender = document.getElementById('gender').value;
            const specificRequest = document.getElementById('specific-request').value;
            
            // 提取服务名称（去掉价格部分）
            const serviceName = serviceType.split(' - ')[0];
            
            let partnerData = null;
            if (serviceName === '婚缘配对分析') {
                partnerData = {
                    name: document.getElementById('partner-name').value,
                    gender: document.getElementById('partner-gender').value,
                    birthYear: document.getElementById('partner-birth-year').value,
                    birthMonth: document.getElementById('partner-birth-month').value,
                    birthDay: document.getElementById('partner-birth-day').value,
                    birthHour: document.getElementById('partner-birth-hour').value,
                    birthMinute: document.getElementById('partner-birth-minute').value
                };
            }
            
            return {
                serviceType: serviceName,
                name,
                birthYear,
                birthMonth,
                birthDay,
                birthHour,
                birthMinute,
                gender,
                specificRequest,
                partnerData
            };
        }
        
        // 更新分析步骤
        function updateAnalysisStep(step) {
            // 重置所有步骤
            for (let i = 1; i <= 4; i++) {
                const stepElement = document.getElementById('step' + i);
                stepElement.classList.remove('completed', 'active');
            }
            
            // 设置已完成步骤
            for (let i = 1; i < step; i++) {
                const stepElement = document.getElementById('step' + i);
                stepElement.classList.add('completed');
            }
            
            // 设置当前步骤
            const currentStep = document.getElementById('step' + step);
            currentStep.classList.add('active');
            
            // 模拟步骤进度
            if (step < 4) {
                setTimeout(() => {
                    updateAnalysisStep(step + 1);
                }, 1500);
            }
        }
        
        // 调用DeepSeek API
        async function callDeepSeekAPI(userData) {
            // 构建提示词
            let prompt = PROMPT_TEMPLATES[userData.serviceType];
            
            // 替换占位符
            prompt = prompt.replace(/{name}/g, userData.name)
                          .replace(/{gender}/g, userData.gender === 'male' ? '男' : '女')
                          .replace(/{birthYear}/g, userData.birthYear)
                          .replace(/{birthMonth}/g, userData.birthMonth)
                          .replace(/{birthDay}/g, userData.birthDay)
                          .replace(/{birthHour}/g, userData.birthHour)
                          .replace(/{birthMinute}/g, userData.birthMinute)
                          .replace(/{specificRequest}/g, userData.specificRequest || '无');
            
            // 如果是婚缘配对分析，替换伴侣信息
            if (userData.serviceType === '婚缘配对分析' && userData.partnerData) {
                prompt = prompt.replace(/{partnerName}/g, userData.partnerData.name || '未提供')
                              .replace(/{partnerGender}/g, userData.partnerData.gender === 'male' ? '男' : '女')
                              .replace(/{partnerBirthYear}/g, userData.partnerData.birthYear || '未提供')
                              .replace(/{partnerBirthMonth}/g, userData.partnerData.birthMonth || '未提供')
                              .replace(/{partnerBirthDay}/g, userData.partnerData.birthDay || '未提供')
                              .replace(/{partnerBirthHour}/g, userData.partnerData.birthHour || '未提供')
                              .replace(/{partnerBirthMinute}/g, userData.partnerData.birthMinute || '未提供');
            }
            
            try {
                const response = await fetch(DEEPSEEK_API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${DEEPSEEK_API_KEY}`
                    },
                    body: JSON.stringify({
                        model: 'deepseek-chat',
                        messages: [
                            {
                                role: 'system',
                                content: '你是一位专业的命理大师，精通八字命理、紫微斗数等传统命理学说。请用专业、详细但易懂的语言为用户提供命理分析。'
                            },
                            {
                                role: 'user',
                                content: prompt
                            }
                        ],
                        max_tokens: 4000,
                        temperature: 0.7
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`API请求失败: ${response.status} ${response.statusText}`);
                }
                
                const data = await response.json();
                
                if (data.choices && data.choices.length > 0) {
                    return data.choices[0].message.content;
                } else {
                    throw new Error('API返回数据格式错误');
                }
                
            } catch (error) {
                console.error('DeepSeek API调用失败:', error);
                // 如果API调用失败，返回模拟数据
                return getMockAnalysisResult(userData);
            }
        }
        
        // 获取模拟分析结果（备用）
        function getMockAnalysisResult(userData) {
            return `【润藏命理分析报告 - ${userData.serviceType}】

尊敬的${userData.name}，您好！

根据您提供的出生信息（${userData.birthYear}年${userData.birthMonth}月${userData.birthDay}日${userData.birthHour}时${userData.birthMinute}分），润藏命理团队为您进行了深入的八字分析。

一、八字原局分析
您的八字为：[八字排盘结果]
日主为[日主]，生于[月令]月，整体格局为[格局类型]。

五行喜忌：
- 喜神：[喜神]
- 用神：[用神]
- 忌神：[忌神]

二、性格特点
您具有[性格特点1]、[性格特点2]的特质，为人[性格描述]。在人际交往中[社交特点]，在事业上[事业倾向]。

三、运势分析
[根据具体服务类型提供相应的运势分析]

四、专业建议
基于您的命局特点，建议您：
1. [建议1]
2. [建议2]
3. [建议3]

以上分析由润藏命理团队专业命理师完成，仅供参考。`;
        }
        
        // 显示分析结果
        function displayAnalysisResult(result) {
            // 显示分析结果区域
            const resultElement = document.getElementById('analysis-result');
            resultElement.style.display = 'block';
            
            // 将结果直接显示在正确的位置
            document.getElementById('result-content').textContent = result;
            
            // 计算字数
            const wordCount = result.replace(/\s/g, '').length;
            document.getElementById('word-count').textContent = wordCount;
            
            // 隐藏加载动画
            document.querySelector('.spinner').style.display = 'none';
            
            // 滚动到结果区域
            resultElement.scrollIntoView({ behavior: 'smooth' });
        }
        
        // 复制结果到剪贴板
        function copyResult() {
            const resultText = document.getElementById('result-content').textContent;
            navigator.clipboard.writeText(resultText).then(() => {
                alert('分析结果已复制到剪贴板');
            }).catch(err => {
                console.error('复制失败:', err);
                alert('复制失败，请手动选择文本复制');
            });
        }
        
        // 下载分析报告
        function downloadResult() {
            const resultText = document.getElementById('result-content').textContent;
            const serviceType = currentPaymentInfo.serviceName;
            const name = currentUserData.name;
            const orderId = currentPaymentInfo.orderId;
            
            const blob = new Blob([`润藏命理分析报告\n\n服务类型：${serviceType}\n姓名：${name}\n订单号：${orderId}\n分析时间：${new Date().toLocaleString()}\n\n${resultText}`], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `润藏命理分析报告_${name}_${orderId}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        // 返回首页
        function goToHome() {
            document.getElementById('success-section').style.display = 'none';
            document.getElementById('analysis-process-section').style.display = 'none';
            document.getElementById('info-form').style.display = 'none';
            document.getElementById('user-info-form').reset();
            resetErrors();
            document.querySelectorAll('.payment-option').forEach(option => {
                option.classList.remove('active');
            });
            
            currentPaymentMethod = null;
            
            // 重置加载动画
            document.querySelector('.spinner').style.display = 'block';
            
            // 滚动到顶部
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        // 页面加载完成后初始化
        window.onload = function() {
            generateTimeOptions();
            
            // 添加实时验证
            document.getElementById('name').addEventListener('blur', function() {
                if (!this.value.trim()) {
                    document.getElementById('name-error').style.display = 'block';
                } else {
                    document.getElementById('name-error').style.display = 'none';
                }
            });
            
            // 替换收款码图片
            document.getElementById('wechat-qr').src = 'images/wechat-pay.jpg';
            document.getElementById('alipay-qr').src = 'images/alipay.jpg';
        };
    </script>
</body>
</html>
